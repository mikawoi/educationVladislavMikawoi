![[Pasted image 20240107160620.png]]

Использовать алгоритм с разными типами можно, используя
- "copy-past" - усложнение поддержки кода (размножение «одинаковых сущностей», внесение новых ошибок)
- макросы - усложнение отладки и поддержки
![[Pasted image 20240107160759.png]]

Правильнее всего для использования алгоритма с разными типами ==написать шаблонный код==

Шаблон (или шаблонный класс/функция) - это механизм в языках программирования, который позволяет создавать универсальные блоки кода, которые могут работать с различными типами данных или значениями. Это позволяет программистам создавать гибкий и повторно используемый код, который может быть адаптирован для различных сценариев использования.

Ключевые слова

- template
  - описание параметризации шаблона
- class и typename
  - именование параметра
![[Pasted image 20240107161210.png]]
![[Pasted image 20240107161231.png]]

```cpp
#include <iostream>

template <class T>
class MyContainer {
private:
  T element;

public:
  void setElement(T elem) {
    element = elem;
  }

  T getElement() {
    return element;
  }
};

int main() {
  MyContainer<int> intContainer;
  intContainer.setElement(5);
  std::cout << intContainer.getElement() << std::endl;

  MyContainer<std::string> stringContainer;
  stringContainer.setElement("Hello, Template");
  std::cout << stringContainer.getElement() << std::endl;

  return 0;
```

Шаблон (template)

- в определении (класса или функции) используется один или несколько неизвестных (именованных) типов
- типы должны быть известны в момент компиляции программы

Преимущества шаблонов

- использование типа при определении функции или класса
- автоматическая генерация кода
- зависит только от тех параметров типа, которые использует
- оптимизация программ

Инстанциирование шаблона

Инстанциирование шаблона - это процесс создания конкретной версии класса или функции на основе шаблонного класса или функции. Во время инстанциирования компилятор использует параметры, переданные шаблону, чтобы сгенерировать код для конкретного типа данных или значений.

- генерация объявления функции (типа) по шаблону функции (типа) и аргументам шаблона
- осуществляется компилятором на этапе компиляции
- сгенерированный код подчиняется стандартным правилам

Шаблонная функция

- определяется шаблоном и набором параметров
*пример*
```cpp
template<typename T>
const T& min(const T& lhs, const T& rhs) {
	return (lhs < rhs) ? lhs : rhs;
	 }
```

Шаблонный класс (тип)

- определяется шаблоном и набором параметров
- при использовании одного набора параметров генерируется один и тот же тип
```cpp
template <class T>
class Stack {
	public:
		Stack();
		...
		T& getTop();
	private:
	T* pData_{nullptr};
	...
};
```

![[Pasted image 20240107162601.png]]

Параметры шаблонов

- типизированный параметр
  - тип, может быть тоже шаблонный
- нетепизированный параметр
  - константа времени компиляции
- параметров может быть несколько 

Шаблоны членов и методов типа

- шаблонный тип может иметь шаблонные члены и шаблонные методы
- нешаблонный тип может иметь шаблонные методы
![[Pasted image 20240107162832.png]]

Нетипизированный параметр

- известное на стадии компиляции целочисленное значение
- в том числе адрес объекта, адрес функции с внешней компоновкой, выражение от типа и т.д.
![[Pasted image 20240107163016.png]]

![[Pasted image 20240107163036.png]]

![[Pasted image 20240107163045.png]]
![[Pasted image 20240107163121.png]]
![[Pasted image 20240107163134.png]]
![[Pasted image 20240107173332.png]]
![[Pasted image 20240107173355.png]]
![[Pasted image 20240107173428.png]]
![[Pasted image 20240107173440.png]]
![[Pasted image 20240107173534.png]]
![[Pasted image 20240107173549.png]]

Размещение шаблонного кода
- определение должно быть доступно в точке инстанциирования
- размещать шаблонный код следует в заголовочных файлах
![[Pasted image 20240107182252.png]]

Определение невстраиваемых методов класса 
это такие методы, которые нельзя изменять в дочерних экземплярах (классах)

![[Pasted image 20240107182507.png]]

![[Pasted image 20240107182643.png]]

Псевдоним шаблона
```cpp
using Type = type_definition;
```
- определить новое имя типа
- "привязать" часть параметров
![[Pasted image 20240107183103.png]]

Тип выражения (decltype)

decltype(E)
- тип имени или выражения E
- может быть использован в объявлениях
```cpp
decltype (x * y);
```

Вывод типа из инициализатора

auto v("выражение");
- Тип переменной определяется при компиляции
- Тип может быть неизвестен, либо сложен в написании
![[Pasted image 20240107183937.png]]
![[Pasted image 20240107184243.png]]

```cpp
template<typename T, typename U>
auto mul (const T& x, const U& y) ->
	decltype(x * y) {
return x * y;	
}
```
Шаблоны с переменным числом параметров 

Слабая типизация
- тип обеспечивает интерфейс, ожидаемый шаблоном
- требуется доступность вызываемых функций для типов, пара
```cpp
template<typename>
const T& min(const T& lhs, const T& rhs) {
	return (lhs < rhs) ? lhs : rhs;
}
```

Генерируемый код

- инстанциирование должно иметь место только для используемого кода
- для каждого уникального набора параметров генерируется свой код
- возможно разбухание программы

Сообщения об ошибках в шаблонном коде

- требуют внимательного разбора
- часто связаны с передачей недопустимых параметров
STL
- шаблонная часть стандартной библиотеки
- содержит много полезных и качественно реализованных типов и функций


Кортеж
- последовательность конечного числа элементов
- пустое множество - кортеж (с нулевым количеством элементов)
- ![[Pasted image 20240108162657.png]]
Упорядоченная пара

- кортеж длинны 2
<e1, e2> = {e1, {e1, e2}}

- сравнение на равенство 
![[Pasted image 20240108162757.png]]
std::pair 
template <class T1, class T2>
struct pair;
поля first и second
производящая функция make_pair

пример: 
auto el(make_pair(a, f(b)));

Вариативный шаблон

template<typename... Args>

- шаблон с переменным числом аргументов
- используется для создания
  - рекурсивных шаблонных типов
  - рекурсивных шаблонных функций
кортеж реализуется через variadic template

Доступ к элементам кортежа
get<. N>() - по индексу элемента
get<. T>() - по типа (для уникальных)
![[Pasted image 20240108163621.png]]